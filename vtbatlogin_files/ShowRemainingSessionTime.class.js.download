/**
 * Create a new instance of ShowRemainingSessionTime.
 *
 * @param idValue
 *            the id of the element where the time is show
 * @param timeout
 *            the timeout in seconds
 * @param timeText
 *            a template for the text with the time is show (place holder "%1")
 * @param logoutPage
 *            the page for logout (timeout reached)
 */
var remainingSessionTimer;

function ShowRemainingSessionTime( idValue, timeout, timeText, logoutPage )
{
  this.idValue = idValue;
  this.timeout = timeout * 1000;
  this.timeText = timeText;
  this.logoutPage = logoutPage;

  this.interval = null;
  this.timeOfStart = null;
}

/**
 * Start the timer.
 */
ShowRemainingSessionTime.prototype.start = function()
{
  this.timeOfStart = new Date();
  this._printTimeToLogout();
  var scope = this;
  this.interval = window.setInterval( function()
                                      {
                                        scope._printTimeToLogout()
                                      }, 250 );
};

/**
 * Start the timer.
 */
ShowRemainingSessionTime.prototype.restart = function()
{
  this.timeOfStart = new Date();
};

ShowRemainingSessionTime.prototype._printTimeToLogout = function()
{
  if( !this.idValue )
    return;
  var elemToShow = document.getElementById( this.idValue );
  if( !elemToShow )
    return;

  var now = new Date().getTime();
  var timeOut = this.timeOfStart.getTime() + this.timeout;
  if( timeOut < now )
  {
    if( this.interval )
      window.clearInterval( this.interval );
    window.location = this.logoutPage;
  }
  else
  {
    var timeLeft = new Date( timeOut - now );

    var sessionTimeoutText;
    var m = timeLeft.getMinutes() + "";
    var s = timeLeft.getSeconds() + "";
    if( m.length == 1 )
      m = "0" + m;
    if( s.length == 1 )
      s = "0" + s;

    var str = m + ":" + s;
    sessionTimeoutText = this.timeText.replace( "%1", str );

    elemToShow.innerHTML = sessionTimeoutText;
  }
};
